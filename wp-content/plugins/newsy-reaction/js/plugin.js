!function(i){"use strict";window.newsy=window.newsy||{},window.newsy.reaction={init:function(e){var r=this;r.xhr=null,r.container=void 0===e?i("body"):e,r.selectors={wrapper:".br-reaction-items",link:".br-reaction",voted:".br-reaction-voted",value:".br-reaction-value",bar:".br-reaction-bar"},r.classes={voting:"br-reaction-voting",voted:"br-reaction-voted"},r.container.on("click",".br-reaction",function(e){e.preventDefault(),r.element=i(this),r.wrapper=r.element.parents(r.selectors.wrapper),r.wrapper.is(r.selectors.voting)||r.element.is(r.selectors.voted)||r.ajax_request()}),i("body").is(".logged-in")||i(r.selectors.link).each(function(){var e=i(this),t=e.parents(r.selectors.wrapper),o=parseInt(t.attr("data-post-id"),10),t=i.trim(e.attr("data-br-reaction"));r.readCookie("br_vote_"+t+"_"+o)?e.addClass(r.classes.voted):e.removeClass(r.classes.voted)})},ajax_request:function(){var r=this;r.wrapper.addClass(r.selectors.voting),r.xhr||(r.xhr=i.ajax({url:ak_ajax_url,type:"post",dataType:"json",data:{post_id:r.wrapper.data("post-id"),nonce:r.wrapper.data("nonce"),vote:r.element.data("vote"),action:"br_vote_post"}}).done(function(e){-1===e.response?(i("#userModal .modal-login-page").find("h3").html(e.message),i.magnificPopup.open({items:{src:"#userModal"}})):1===e.response&&(r.reaction_voted(e.vote),r.update_votes(e.votes))}).fail(function(e,t,o){"error"===t?alert(o.toString()):"timeout"===t&&alert("Execution Timeout")}).always(function(e,t,o){r.xhr=null,r.wrapper.removeClass(r.selectors.voting)}))},reaction_voted:function(e){var t=this,o=t.wrapper.data("post-id"),r=t.wrapper.data("post-url");t.createCookie("br_vote_"+e+"_"+o,!0,30,encodeURIComponent(r)),t.wrapper.find(t.selectors.link).removeClass(t.classes.voted),t.wrapper.find(".br-reaction-"+e).addClass(t.classes.voted)},update_votes:function(a){var n=this;n.wrapper.find(n.selectors.link).each(function(){var e=i(this),t=i.trim(e.data("vote")),o=0,r=0;void 0!==a[t]&&(o=a[t].count,r=a[t].percentage),e.find(n.selectors.value).text(o),e.find(n.selectors.bar).css("height",r+"%")})},createCookie:function(e,t,o,r){var a=o?((a=new Date).setTime(a.getTime()+24*o*60*60*1e3),"; expires="+a.toUTCString()):"";document.cookie=e.concat("=",t,a,"; path="+r)},readCookie:function(e){for(var t=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r+=1){for(var a=o[r];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},deleteCookie:function(e){this.createCookie(e,"",-1,"")}},newsy.reaction.init(),i(document).on("newsy-ajax-load",function(e,t){newsy.reaction.init(i(t))})}(jQuery);