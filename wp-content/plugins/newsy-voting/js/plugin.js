!function(a){"use strict";window.newsy=window.newsy||{},window.newsy.voting={init:function(n){var t=this;t.container=void 0===n?a("body"):n,t.container.find(".ak-voting-button").off("click").on("click",function(n){n.preventDefault(),a(this).hasClass("voting")||(t.element=a(this),t.parent=t.element.parent(),t.up_btn=t.parent.find(".up-btn"),t.down_btn=t.parent.find(".down-btn"),t.ajax_request())})},ajax_request:function(){var o=this,t=o.element.data("post-id"),n=o.element.data("type"),e=o.element.data("nonce");o.parent.addClass("voting"),o.xhr||(o.xhr=a.ajax({url:ak_ajax_url,type:"post",dataType:"json",data:{post_id:t,vote:n,nonce:e,action:"newsy_post_vote"}}).done(function(n){-1===n.response?(a("#userModal .modal-login-page").find("h3").html(n.message),a.magnificPopup.open({items:{src:"#userModal"}})):(n.avg_count&&(o.parent.find(".ak-voting-count .counts").text(n.avg_count),a(".ak-module.post-"+t+" .ak-module-voting-count .count").text(n.avg_count)),n.up_count&&o.up_btn.find("span").text(n.up_count),n.down_count&&o.down_btn.find("span").text(n.down_count),o.parent.addClass("post-voted"),1===n.vote&&o.parent.removeClass("down-voted").addClass("up-voted"),-1===n.vote&&o.parent.removeClass("up-voted").addClass("down-voted"),0===n.vote&&o.parent.removeClass("post-voted").removeClass("up-voted").removeClass("down-voted"))}).fail(function(n,t,e){"error"===t?alert(e.toString()):"timeout"===t&&alert("Execution Timeout")}).always(function(n,t,e){o.xhr=null,o.element.attr("data-message",n.message),o.parent.removeClass("voting")}))}},newsy.voting.init(),a(document).on("newsy-ajax-load",function(n,t){newsy.voting.init(a(t))}),a(".ak-pagination-container").on("ak-pagination-after-response",function(n,t){newsy.voting.init(a(t))})}(jQuery);